@*@model Do_An_Chuyen_Nganh.Models.Product

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<div class="row">
    <div class="col-md-4 list-receiver">
        <ul>
            <div class="card">
                <div class="card-body">
                    <button class="btn btn-success" style="width: 100%;" onclick="toggleChat('@Model.UserId')">
                        <h4 class="card-title">@Model.UserName</h4>
                        <p class="card-text">last message</p>
                    </button>
                </div>
            </div>
        </ul>
    </div>
    <div class="col-md-8">
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <h5>@Model.UserName</h5>
                <input id="userInput" value="@Model.UserId" type="hidden" />
                <button class="btn" onclick="toggleChat('@Model.UserId', '@User.Identity.Name')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
                    </svg>
                </button>
            </div>
            <div class="chat-body">
                <!-- Những tin nhắn trò chuyện sẽ được hiển thị ở đây -->
                <ul id="messagesList"></ul>
            </div>
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="Nhập tin nhắn...">
                <button id="sendButton">Gửi</button>
            </div>
        </div>
    </div>
</div>


<script>
    var senderId = "@User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value";
    var receiverId = "@Model.UserId";
    function toggleChat(receiverId, senderId) {
        var chatWindow = document.getElementById('chatWindow');
        chatWindow.classList.toggle('open');

        if (chatWindow.classList.contains('open')) {
            // Connect to SignalR with receiver ID
            connection.invoke("AddToGroup", receiverId);
        } else {
            // Disconnect or perform any cleanup
            connection.invoke("RemoveFromGroup", receiverId);
        }
    }
     getReceiversBySender('senderIdToCheck');
</script>
<style>
    .chat-window {
        position: fixed;
        bottom: 0;
        right: 20px;
        width: 300px;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: none;
        flex-direction: column;
    }

        .chat-window.open {
            height:450px;
            display: flex;
        }

    .chat-header {
        background-color: #007bff;
        color: #fff;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .close-chat {
        background: none;
        border: none;
        color: #fff;
        cursor: pointer;
    }

    .chat-body {
        overflow-y: auto;
        padding: 10px;
        flex-grow: 1;
    }

    .chat-input {
        display: flex;
        align-items: center;
        padding: 10px;
        border-top: 1px solid #ccc;
    }

        .chat-input input {
            flex-grow: 1;
            margin-right: 10px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .chat-input button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
   
</style>

@section scripts{
    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script src="~/lib/jquery/dist/jquery.unobtrusive-ajax.min.js"></script>
    <script src="~/js/chat.js"></script>
}*@